#数字图像处理第三次作业
1. 姓名：周瑞虎
2. 班级：自动化61
3. 学号：2160504027
4. 提交日期：2019/3/17
***
###       摘要：直方图均衡化可以使得亮度可以更好地在直方图上分布，有效地解决了图片灰度值分布过密地情况，有效增强了图像地对比度，直方图匹配的过程中使用了标准原图像的直方图分布特性，而且求解过程中使用了近似解，这在图像处理地领域是很常见的。局部直方图增强可以解决一些局部的有效信息被掩盖地情况，基于直方图统计的直方图分割在目标和背景颜色相差很大的时候可以很好的分割，但是对于一些比较复杂的分割任务，仍然需要改进。
***
###1.把附件图像的直方图画出；
图像直方图的计算公式：	
$$
p(r_k) = \frac{n_k}{MN}\quad\quad k =1,2...L-1
$$
使用这个公式来计算所有图片的直方图，并且注意先使用ind2gray函数先把所有文件名后缀是数字，例如，lena1.bmp的改为位图显示，之后在进行计算。
![](https://i.imgur.com/47N4e5s.png)
![](https://i.imgur.com/TicU95T.png)
![](https://i.imgur.com/JgYKulC.png)
![](https://i.imgur.com/AAhKcjE.png)

***
###2.把所有图像进行直方图均衡；输出均衡后的图像和源图像进行比对；分析改善内容；
直方图均衡的公式为
$$
s_k  = T(r)=(L - 1)\sum_{i=0}^{k}p_r(r_i)=\frac{(L-1)}{MN}\sum_{j=0}^kn_j,\quad\quad k = 0,1,...L-1
$$
其中MN是像素总的个数，$n_i$是灰度为$r_i$d的像素总数，L是图中可能的像素总数。在计算过程中可能$s_k$会有非整数出现，只需要四舍五入即可，保证变换之后仍然是整数像素。
![](https://i.imgur.com/5AzMvAV.jpg)
![](https://i.imgur.com/PYAS9C4.jpg)
![](https://i.imgur.com/vHJR8OV.jpg)
![](https://i.imgur.com/g4GeYnm.jpg)
不难看出，对于大部分陷入黑色的图片，即elain3，woman3，lena2，lena3，citywall2即分不清楚图片的内容的情况，直方图均衡都可以取得比较好的效果，但是如果图片本身的灰度分布过于分散，均衡化能够比之前的图片取得好的效果，但是基本无改善，所有后缀为1的图片就属于这种情况，图片处理效果差。

***
###3.进一步把图像按照对源图像直方图的观察，各自自行指定不同源图像的直方图，进行直方图匹配，进行图像增强；
直方图均衡的原理是
$$
s_k  = T(r)=(L - 1)\sum_{i=0}^{k}p_r(r_i)=\frac{(L-1)}{MN}\sum_{j=0}^kn_j,\quad\quad k = 0,1,...L-1
$$
$$
G(z_q) = (L-1)\sum_{i=0}^{q}p_z(z_i)
$$
对于每一个q值，
$$
z_q=G^{-1}(s_k)
$$
有时候计算$G^{-1}$是比较困难的，因而使用近似的方法，寻找最近的$s_k$代替是比较长用的一种方法。
![](https://i.imgur.com/aEC24JG.jpg)
![](https://i.imgur.com/wTJmA9m.jpg)
![](https://i.imgur.com/cVcO5HO.jpg)
![](https://i.imgur.com/rCHyzxr.jpg)
***
![](https://i.imgur.com/p1NMxfj.jpg)
值得说明的是，因为所有后缀为1的图片的调色板内颜色个数小于256，这一点从文件大小也可以看出来。在matlab显示的时候缺失的颜色会默认为1显示，造成matlab的显示图片比默认为0显示的window图片看来要偏亮一点，而且所有会缀有数字的图片都要使用matlab自带的函数ind2gray转为灰度图，经过实验，发现转的时候，仍然默认缺失的颜色是1，这就造成了本例中的显示效果，经过实验，发现使用matlab的缺失颜色默认补1的方法，直方图匹配出来的效果很好，优于缺失补0的效果，第五张图是我自己使用默认缺失补0的方法做出来的，发现，和上面四张图相比，处理效果差。

直方图匹配的方法，是使用了源图像的直方图信息，进行了一次均衡化之后，然后逆变化了一次，这种方法优点在于匹配后的图片效果很好，但是在实际中，可能并没有很好的原图像供你使用，而且本次实验中，我发现，要是用错了目标直方图，效果还不如直方图均衡化，因而使用要确保目的直方图正确合理。
***
###4.对elain和lena图像进行7*7的局部直方图增强；
全局直方图增强的时候，像素被基于整幅图像的灰度改变函数修改。但是在一些情况下，增强图像中小区域的细节也是必须的。在这些区域中，一些像素的影响在全局变换的过程中被忽略了，因而必须以每个像素的邻域中的灰度分布为基础设计变换函数。
本次实验中，我使用的是定义一个邻域，逐次移动一个像素点，这种方法虽然可以避免棋盘效应，但是带来的缺失运算量的迅速增加，大约每幅图需要使用80s才能出来结果，局部直方图可以显示一些隐藏在图片里的信息，而全局直方图做不到细节的显示，但是运算量是一个必须要考虑的重要因素。
![](https://i.imgur.com/PWStMO2.png)
![](https://i.imgur.com/W8woa5d.png)
***
###5.利用直方图对图像elain和woman进行分割；
基于直方图的图像分割，在本次实验中，我设计的终止条件是增量小于2时，终止循环，最终得到的分割像素分别是是elain---130，woman ---101，对两幅图而言，woman图取得的分割效果是比较好的，但是elain由于背景和目标在直方图的层面上分的不够开，因而取得的分割效果不好，这也说明了基于直方图统计的直方图增强的局限性。
![](https://i.imgur.com/CVDyCW9.png)
![](https://i.imgur.com/ruSnzbP.png)

***
参考文献：
- 数字图像处理（第三版）冈萨雷斯

